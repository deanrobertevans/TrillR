<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selection Workflow V2 • TrillR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Selection Workflow V2">
<meta property="og:description" content="TrillR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TrillR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Workflow.html">Selection Workflow V2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Workflow_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Selection Workflow V2</h1>
            
      
      
      <div class="hidden name"><code>Workflow.Rmd</code></div>

    </div>

    
    
<p>The following vignette has been developed to outline the recording selection process. This workflow is specific to selecting acoustic recordings for the identification of landbirds in the Northwest Territories, Canada by the Canadian Wildlife Service. This workflow can be modified for your own purposes.</p>
<div id="clear-workspace" class="section level3">
<h3 class="hasAnchor">
<a href="#clear-workspace" class="anchor"></a>Clear Workspace</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-required-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#load-required-packages" class="anchor"></a>Load Required Packages</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install TrillR if needed</span>
<span class="co">#devtools::install_github("deanrobertevans/TrillR")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">TrillR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datastorm-open/suncalc">suncalc</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hms.tidyverse.org/">hms</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="set-working-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#set-working-directory" class="anchor"></a>Set Working Directory</h3>
<p>Your working directory will be the location of all of the recordings you want to select from. It is important that recordings are organized in folders within this working directory. Each folder named after the location of the recordings it contains.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"G:\\Deployed_ARU_Recordings"</span><span class="op">)</span></code></pre></div>
</div>
<div id="set-the-location-of-sox-exe" class="section level3">
<h3 class="hasAnchor">
<a href="#set-the-location-of-sox-exe" class="anchor"></a>Set the Location of sox.exe</h3>
<p>The TrillR package uses SoX to deal with .wav file manipulation and generating spectrograms. To use many of the functions in this package your first need to direct the package to the location of the sox.exe. The latest release can be downloaded here <a href="https://sourceforge.net/projects/sox/files/sox/" class="uri">https://sourceforge.net/projects/sox/files/sox/</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setsox.exe.html">setsox.exe</a></span><span class="op">(</span><span class="st">"C:/Users/deane/Desktop/sox-14.4.2/sox.exe"</span><span class="op">)</span></code></pre></div>
</div>
<div id="get--wav-data" class="section level3">
<h3 class="hasAnchor">
<a href="#get--wav-data" class="anchor"></a>Get .wav Data</h3>
<p>Use the the <code><a href="../reference/get.wavs.html">get.wavs()</a></code> function to get all recordings and metadata. You can also get the file durations using <code>getDuration=T</code>, however this can be time consuming. If you choose to get file durations then you can filter out recordings that are shorter than a required length (e.g. 180s or 3 min).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.wavs.html">get.wavs</a></span><span class="op">(</span>start.date <span class="op">=</span> <span class="st">"2017-06-01"</span>,end.date <span class="op">=</span> <span class="st">"2017-06-30"</span>, getDuration<span class="op">=</span><span class="cn">F</span>, minduration <span class="op">=</span> <span class="fl">180</span><span class="op">)</span>
<span class="co"># Save file so you don't have to read files again. Especially if you got file durations.</span>
<span class="co">#write.csv(data,"data.csv")</span>

<span class="co">#head(data)</span></code></pre></div>
</div>
<div id="read-in-location-data-and-merge" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-location-data-and-merge" class="anchor"></a>Read in Location Data and Merge</h3>
<p>Location data is important if you want to calculate sun time such as sunset and sunrise for selecting recordings. The <code><a href="../reference/mergelocations.html">mergelocations()</a></code> function will merge this data for you and alert you of any problems.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">locationdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"LV.xlsx"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mergelocations.html">mergelocations</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">locationdata</span>,locationname <span class="op">=</span> <span class="st">"Location"</span>, Latitude <span class="op">=</span> <span class="st">"Latitude"</span>, Longitude <span class="op">=</span> <span class="st">"Longitude"</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculate-sunrisesunset" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-sunrisesunset" class="anchor"></a>Calculate Sunrise/Sunset</h3>
<p>Sunrise and Sunset are both used to categorize recordings of interest for interpretation. In order to calculate these our data needs to have coordinates which we did above. For increased speed we will run this function in parallel.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSunCalcs.html">getSunCalcs</a></span><span class="op">(</span><span class="va">data</span>, calc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sunrise"</span>,<span class="st">"sunset"</span><span class="op">)</span>, doParallel<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
</div>
<div id="categorize-recordings" class="section level3">
<h3 class="hasAnchor">
<a href="#categorize-recordings" class="anchor"></a>Categorize Recordings</h3>
<p>Next is to put recordings into time categories for selection. The idea is that for each location there will be one randomly selected recording for each category. For our purposes lets create 8 time categories. We will divide the the recordings up into two equal halves of the month of June depending on the number of days of recordings for each location. The first half will be early (‘E’) and the second half will be late (L). Then for each early and late June recordings we will select four time periods: an hour before sunrise to an hour after sunrise, an hour after sunrise to three hours after sunrise, three hours after sunrise to five hours after sunrise, and an hour before sunset to an hour after sunset. This results in 8 categories to define:</p>
<ul>
<li>EE First half of recordings and an hour before sunrise to an hour after sunrise.</li>
<li>LE Second half of recordings and an hour before sunrise to an hour after sunrise.</li>
<li>EM First half of recordings and an hour after sunrise to three hours after sunrise.</li>
<li>LM Second half of recordings and an hour after sunrise to three hours after sunrise.</li>
<li>EL First half of recordings and three hours after sunrise to five hours after sunrise.</li>
<li>LL Second half of recordings and three hours after sunrise to five hours after sunrise.</li>
<li>EN First half of recordings and an hour before sunset to an hour after sunset.</li>
<li>LN Second half of recordings and an hour before sunset to an hour after sunset.</li>
</ul>
<p>To achive this we can generate columns for start and end dates/times that is precalculated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>category<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunset</span><span class="op">-</span><span class="fl">3600</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunset</span><span class="op">+</span><span class="fl">3600</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"EN"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunset</span><span class="op">-</span><span class="fl">3600</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunset</span><span class="op">+</span><span class="fl">3600</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"LN"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">-</span><span class="fl">3600</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="fl">3600</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"EE"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">-</span><span class="fl">3600</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="fl">3600</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"LE"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="fl">3601</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"EM"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="fl">3601</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"LM"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"EL"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>start.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,end.date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">JDay</span><span class="op">)</span>,start.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,end.time<span class="op">=</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">sunrise</span><span class="op">+</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/categorize.html">categorize</a></span><span class="op">(</span><span class="st">"LL"</span>,<span class="va">start.date</span>,<span class="va">end.date</span>,<span class="va">start.time</span>,<span class="va">end.time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">start.date</span>,<span class="op">-</span><span class="va">end.date</span>,<span class="op">-</span><span class="va">start.time</span>,<span class="op">-</span><span class="va">end.time</span><span class="op">)</span>


<span class="co">#### Remove NAs for your final data to select from.</span>
<span class="va">dataselection</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">category</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="spectrogram-generation" class="section level3">
<h3 class="hasAnchor">
<a href="#spectrogram-generation" class="anchor"></a>Spectrogram Generation</h3>
<p>Now that we have all available recordings categorized we can create spectrograms to assess weather suitability using the TrillR app. This can be done multiple ways but if you have time to spare it is recommended to generate a spectrogram for all selectable recordings to prevent having to multiple rounds of recording selection. Using <code>slice_sample(prop = 1)</code> will randomly order recordings for selection in the TrillR app. The idea is to choose the first suitable recording for interpratation hence the random order even though all available recordings are being sampled.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Random sample of all eligible recordings (essentially all recordings but reorders them)</span>
<span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">dataselection</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">location</span>,<span class="va">category</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="../reference/sox.spectrograms.html">sox.spectrograms</a></span><span class="op">(</span><span class="va">sample</span>, duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0</span>, end <span class="op">=</span> <span class="fl">180</span><span class="op">)</span>, doParallel <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="co"># 3 ninute spectrogram</span></code></pre></div>
<p>The <code><a href="../reference/sox.spectrograms.html">sox.spectrograms()</a></code> function will output a recording selection file that needs to be input into the TrillR App.</p>
</div>
<div id="recording-selection" class="section level3">
<h3 class="hasAnchor">
<a href="#recording-selection" class="anchor"></a>Recording Selection</h3>
<p>To do recording selection using the TrillR app follow these steps:</p>
<ol style="list-style-type: decimal">
<li><p>Drag your recordingselection.csv file into the TrillR App or Browse for it using the browse button. The app will check your file for all required columns needed for it to run properly.</p></li>
<li><p>If you everything was uploaded correctly you will now be within the main part of the app which will allow you to view and select recordings. For a complete guide on how to use this app please visit the GitHub page here: <a href="https://github.com/deanrobertevans/TrillRApp" class="uri">https://github.com/deanrobertevans/TrillRApp</a>.</p></li>
<li><p>Use the app to select your recordings. Recordings are randomly organized so choose the first suitable recording.</p></li>
<li><p>Once your selection is done save your selection data using the download button and read it back into R. Check that you have the correct number of recordings. If you are missing selections you may need to repeat the selection process after you have removed already selected recordings.</p></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selectiondata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"selectedrecordings.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">selectiondata</span> <span class="op">&lt;-</span> <span class="va">selectiondata</span><span class="op">[</span><span class="va">selectiondata</span><span class="op">$</span><span class="va">Selected</span> <span class="op">==</span><span class="st">"Yes"</span>,<span class="op">]</span> <span class="co">### Just get selected</span></code></pre></div>
</div>
<div id="clip-selection-to-length" class="section level3">
<h3 class="hasAnchor">
<a href="#clip-selection-to-length" class="anchor"></a>Clip Selection to Length</h3>
<p>After you have determined your recording selection the final step might be to clip those files to length as they can often be much longer than what is needed for transcription.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/sox.clips.html">sox.clips</a></span><span class="op">(</span><span class="va">selectiondata</span>,out.path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"Clipped_Selection"</span><span class="op">)</span>, duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0</span>, end <span class="op">=</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dean Evans.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
